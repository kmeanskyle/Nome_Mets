---
title: "Find Nome"
output: pdf_document
---
# Display Nome in the ERA5 grid

```{r setup, echo = FALSE}
# make a df of rect boundaries and colors from df of grid center points
#   and land proportions
make_mask_df <- function(df) {
  res <- 0.25/2
  data.frame(xleft = df[, 1] - res, xright = df[, 1] + res,
             ybottom = df[, 2] - res, ytop = df[, 2] + res)
}
  
library(ncdf4)
library(knitr)

# extract lon and lat from nc file and close
lsm_path <- "F:/raw_data/Nome_Mets/ERA5_land_sea_mask_Nome_sector.nc"
lsm_nc <- nc_open(lsm_path)
lon <- ncvar_get(lsm_nc, varid = "longitude")
lat <- ncvar_get(lsm_nc, varid = "latitude")
lsm <- ncvar_get(lsm_nc, varid = "lsm")
nc_close(lsm_nc)

Nlon <- -165.406387
Nlat <- 64.501114
Nome_coords <- c(Nlon, Nlat)
Nome_coords[1] <- 360 - Nome_coords[1] * (-1)
Nome_coords <- data.frame(x = Nome_coords[1], y = Nome_coords[2])
```

Nome coordinates: `r paste0("Lon: ", Nlon, "; Lat: ", Nlat, " (lon used in ERA5: ", Nome_coords[1], ")")`

```{r plot, echo = FALSE}
# plot grid and Nome
coords <- expand.grid(lon, lat)
mask_df <- make_mask_df(coords)
mask_df$lsm <- round(as.vector(lsm))
mask_cols <- c("#3399FF", "#669900")

plot(coords, xlab = "Lon", ylab = "Lat")
rect(mask_df$xleft, mask_df$ybottom, mask_df$xright, mask_df$ytop, 
     col = mask_cols[mask_df$lsm+1])
points(coords, pch = 19)
points(Nome_coords, col = "red", pch = 19)


# save extent values of the 9 cells around Nome 
xd <- Nome_coords$x[1] - lon 
yd <- Nome_coords$y[1] - lat
# west extent index
wei <- which(xd == min(xd[which(xd > 0)])) - 1
# east extent index
eei <- wei + 2
# south extent index
sei <- which(yd == min(abs(yd))) + 1
# North extent index
nei <- sei - 2

bb <- data.frame(value = c(lat[nei], lon[wei], lat[sei], lon[eei]),
                 extent = c("north", "west", "south", "east"))
write.csv(bb, "data/Nome_bb.csv")

```

The bounds for the nine cells around Nome (N and S and the two adjacent inland (E)) are: `r kable(bb)` and are saved as **Nome_bb.csv**